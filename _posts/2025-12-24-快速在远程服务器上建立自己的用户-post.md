以下是在 Linux 服务器（Ubuntu）上**新建用户、赋予 sudo 权限、安装 Miniconda，配置CUDA** 的完整步骤，操作均通过命令行完成，适用于无图形界面的服务器环境：
### 一、新建用户并赋予 sudo 权限

#### 1. 登录服务器（需 root 或已有 sudo 权限的用户）

先通过 SSH 登录服务器（若已在服务器本地，可直接跳过）：
```bash
ssh 用户名@服务器IP # 例如：ssh root@192.168.1.100
```
#### 2. 新建用户（以用户名 `conda-user` 为例）

使用 `useradd` 命令，通过 `-d` 指定家目录路径，`-m` 自动创建该目录（必须加 `-m`，否则需手动创建目录并授权）：
```bash
# 格式：sudo useradd -m -d 自定义家目录路径 用户名 
sudo useradd -m -d /data/conda-user conda-user # 若当前是 root 用户，可省略 sudo
```

#### 3. 为新用户设置密码

执行以下命令，按提示输入密码（密码输入时不显示，输完回车即可）：
```bash
sudo passwd conda-user
```

#### 4. 赋予 sudo 权限

sudo 权限的核心是将用户添加到 **sudo 组**（Ubuntu/Debian）或 **wheel 组**（CentOS/RHEL），步骤如下：
```bash
sudo usermod -aG sudo conda-user
```

#### 5. 把新建用户的默认 Shell 改成 `bash`
```bash
# 格式：sudo chsh -s /bin/bash 用户名 
sudo chsh -s /bin/bash conda-user
```

#### 6.配置 PS1

```bash
su - conda-user # 确保加载用户自己的环境（带 - 符号）
nano ~/.bashrc
#一直往下翻到文件最末尾，粘贴下面的命令
export PS1="\[\e[32m\]\u\[\e[0m\]@\[\e[34m\]\h\[\e[0m\]:\[\e[33m\]\w\[\e[0m\]\$ "
#粘贴完成后，按以下组合键：Ctrl + O保存，enter确认，Ctrl + X退出
#执行以下命令，让修改后的配置生效：
source ~/.bashrc
```

#### 7.安装miniconda

[安装Miniconda - Anaconda](https://www.anaconda.com/docs/getting-started/miniconda/install#linux-2)

```bash
mkdir -p ~/miniconda3 
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda3/miniconda.sh 
bash ~/miniconda3/miniconda.sh -b -u -p ~/miniconda3 
rm ~/miniconda3/miniconda.sh
source ~/miniconda3/bin/activate
conda init --all
```

#### 8.配置CUDA

##### 服务器上有CUDA

多CUDA版本管理可参考：CUDA软连接[CUDA安装与多版本管理_安装多个cuda版本-CSDN博客](https://blog.csdn.net/weixin_54358182/article/details/148135224)

- 首先在**主用户终端**执行以下命令，确认 CUDA 的实际安装路径：
```bash
# 查看 cuda 软链接指向（最常用） 
ls -l /usr/local/cuda # 输出示例：lrwxrwxrwx 1 root root 12 1月 1 00:00 /usr/local/cuda -> cuda-12.2/ 
```
 记录核心路径：`/usr/local/cuda`（或实际版本路径，如 `/usr/local/cuda-12.2`，用软链接路径更方便，后续升级 CUDA 无需改配置）。

- 编辑 .bashrc 文件
```bash
nano ~/.bashrc
# CUDA 环境变量配置（粘贴到 .bashrc 末尾） 
export CUDA_HOME=/usr/local/cuda # 对应步骤1的 CUDA 路径
export PATH=$CUDA_HOME/bin:$PATH # 让系统找到 nvcc 等工具 
export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH # 让程序找到 CUDA 库文件
#重新加载配置
source ~/.bashrc
#验证nvcc
nvcc -V 
# 注意是大写 V，输出示例：
 # NVIDIA (R) Cuda compiler driver # Copyright (c) 2005-2023 NVIDIA Corporation # Built on Tue_Aug_15_22:02:13_PDT_2023 # Cuda compilation tools, release 12.2, V12.2.140 # Build cuda_12.2.r12.2/compiler.33191640_0
```

##### 服务器上没有CUDA，在conda环境中配置cuda相关

包含基本的虚拟环境cuda安装和cuda编程可能用到的编译工具

###### 1. 先创建 / 激活 Conda 虚拟环境
```bash
# 1. 创建新环境（示例：python 3.10，可根据需求改版本）
conda create -n cuda-env python=3.10

# 2. 激活环境（后续所有操作都在这个环境内）
conda activate cuda-env
```

###### 2. 在环境内安装 CUDA Toolkit（虚拟环境专属）
```bash
# 格式：conda install -c conda-forge cudatoolkit=xx.x （xx.x 是 CUDA 版本，如 12.2、11.8）
conda install -c conda-forge cudatoolkit=12.2
conda install -c conda-forge cuda-nvcc=12.2
conda install -c conda-forge cuda-cudart-dev=12.2
```

- 安装后，CUDA 工具（`nvcc`）、库文件都在 `~/miniconda3/envs/cuda-env/`（或你的自定义家目录路径）下，完全隔离。

在CUDA编程中，如果**CUDA 版本不支持服务器当前的高版本 GCC 编译器**（比如 GCC 12+）—— nvcc 对宿主编译器（GCC）有版本限制，12.2 及更早的 CUDA 仅支持 GCC ≤ 11，而服务器默认 GCC 版本超过了这个限制。
无需修改系统全局 GCC（避免影响其他用户），在 Conda 环境内安装 **兼容的低版本 GCC（比如 GCC 11）**，编译时让 nvcc 调用这个环境内的 GCC，全程隔离，不影响系统。

- 在环境内安装 GCC 11（兼容 CUDA 12.2 及以下）
```bash
conda install -c conda-forge gcc=11 gxx=11  # gcc（C 编译器）和 gxx（C++ 编译器）都要装
gcc --version # 输出示例：gcc (conda-forge gcc 11.4.0) 11.4.0，说明环境内已切换到 GCC 11 
g++ --version # 同样输出 11.x 版本
```


### 其他的一些问题

#### 切换文件夹权限

查看目标目录的权限与所属信息
```bash
ls -ld /目标目录路径
```
输出示例：`drwxr - xr - x 2 root root 4096 Dec 23 10:00 /mnt/sata1/shared`

- 第一位 `d` 是目录；后续三组 `rwx` 对应所有者、所属组、其他用户权限
- 若其他用户权限为 `r - x`（无 `w`），或你不在所有者 / 所属组，就无法新建文件夹

确认当前用户与组
```bash
id  # 查看当前用户 UID、GID 及所属组
```

修改目录所有者（适合个人专属目录）
```bash
sudo chown -R 你的用户名:你的用户组 /目标目录路径  # -R 递归应用到子目录
sudo chmod u+rwx /目标目录路径  # 确保所有者有完整权限（通常默认已有）
```
